package org.opentestsystem.rdw.admin;

import org.junit.Ignore;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.opentestsystem.rdw.script.Pipeline;
import org.opentestsystem.rdw.script.PipelineFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.context.junit4.SpringRunner;

import static org.assertj.core.api.Assertions.assertThat;

// TODO delete
@RunWith(SpringRunner.class)
@ActiveProfiles("test")
@SpringBootTest
public class PipelineFactoryIT {

    @Autowired
    private PipelineFactory pipelineFactory;

    private static final String script = "enable 'xml'\n"+
            "\n"+
            "transform '//book' by {\n"+
            "  it.text = 'bookers'\n"+
            "}\n"+
            "\n"+
            "outputXml";

    private static final String input = "<books>\n<book>\nbooky\n</book>\n</books>";

    @Test
    @Ignore("this is for ad-hoc integration testing support")
    public void itShouldRunPipelineFactory() {
        final Pipeline pipeline = pipelineFactory.getDevelopmentPipeline(script);
        final String result = pipeline.run(input).asString();
        assertThat(result).isEqualTo(input.replace("booky", "bookers"));
    }

}
