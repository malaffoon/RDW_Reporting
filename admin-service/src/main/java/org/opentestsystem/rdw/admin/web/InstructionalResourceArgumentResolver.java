package org.opentestsystem.rdw.admin.web;

import com.google.common.primitives.Ints;
import org.opentestsystem.rdw.admin.model.InstructionalResource;
import org.opentestsystem.rdw.reporting.common.model.OrganizationType;
import org.springframework.core.MethodParameter;
import org.springframework.web.bind.support.WebDataBinderFactory;
import org.springframework.web.context.request.NativeWebRequest;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.method.support.ModelAndViewContainer;

import static java.lang.Integer.parseInt;
import static org.apache.commons.lang3.StringUtils.trimToEmpty;

/**
 * Argument resolver for {@link InstructionalResource} instances.
 */
public class InstructionalResourceArgumentResolver implements HandlerMethodArgumentResolver {

    @Override
    public boolean supportsParameter(final MethodParameter parameter) {
        return parameter.getParameterType().equals(InstructionalResource.class);
    }

    @Override
    public Object resolveArgument(final MethodParameter parameter, final ModelAndViewContainer mavContainer, final NativeWebRequest webRequest, final WebDataBinderFactory binderFactory) throws Exception {
        return InstructionalResource.builder()
                .assessmentName(webRequest.getParameter("assessmentName"))
                .organizationType(OrganizationType.caseInsensitiveValue(webRequest.getParameter("organizationType")))
                .organizationId(Ints.tryParse(trimToEmpty(webRequest.getParameter("organizationId"))))
                .performanceLevel(parseInt(webRequest.getParameter("performanceLevel")))
                .build();
    }
}
