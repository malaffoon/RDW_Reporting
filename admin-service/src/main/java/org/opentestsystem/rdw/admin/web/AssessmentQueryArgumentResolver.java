package org.opentestsystem.rdw.admin.web;

import com.google.common.primitives.Ints;
import org.opentestsystem.rdw.admin.model.AssessmentQuery;
import org.springframework.core.MethodParameter;
import org.springframework.web.bind.support.WebDataBinderFactory;
import org.springframework.web.context.request.NativeWebRequest;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.method.support.ModelAndViewContainer;

import static org.apache.commons.lang3.StringUtils.trimToEmpty;

/**
 * Argument resolver for AssessmentQuery instances.
 */
public class AssessmentQueryArgumentResolver implements HandlerMethodArgumentResolver {

    static final int DefaultLimit = 20;

    @Override
    public boolean supportsParameter(final MethodParameter parameter) {
        return parameter.getParameterType().equals(AssessmentQuery.class);
    }

    @Override
    public Object resolveArgument(final MethodParameter parameter, final ModelAndViewContainer mavContainer, final NativeWebRequest webRequest, final WebDataBinderFactory binderFactory) throws Exception {
        final Integer limit = Ints.tryParse(trimToEmpty(webRequest.getParameter("limit")));
        return AssessmentQuery.builder()
                .limit(limit == null ? DefaultLimit : limit)
                .label(webRequest.getParameter("label"))
                .name(webRequest.getParameter("name"))
                .build();
    }
}
