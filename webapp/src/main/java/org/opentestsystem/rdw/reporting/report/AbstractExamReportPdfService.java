package org.opentestsystem.rdw.reporting.report;

import org.opentestsystem.rdw.reporting.common.report.AbstractBatchExamReportRequest;
import org.opentestsystem.rdw.reporting.common.report.AbstractExamReportRequest;
import org.opentestsystem.rdw.reporting.common.report.BatchExamReportRequestHolder;
import org.opentestsystem.rdw.reporting.common.report.PrintOptions;
import org.opentestsystem.rdw.reporting.common.security.PermissionScope;
import org.opentestsystem.rdw.reporting.security.User;

import javax.validation.constraints.NotNull;
import java.util.UUID;

public class AbstractExamReportPdfService<T extends AbstractBatchExamReportRequest<PrintOptions>> implements ExamReportPdfService<T> {

    private ProcessorSource<BatchExamReportRequestHolder> source;
    private final String permission;

    protected AbstractExamReportPdfService(final ProcessorSource<BatchExamReportRequestHolder> source, final String permission) {
        this.permission = permission;
    }

    @Override
    public String queueExamReports(final User user, @NotNull final T request) {
        final PermissionScope permissionScope = user.getPermissionsById().get(permission).getScope();

        final BatchExamReportRequestHolder holder = new BatchExamReportRequestHolder(request, permissionScope);

        source.send(holder);

        return holder.getId();
    }
}
