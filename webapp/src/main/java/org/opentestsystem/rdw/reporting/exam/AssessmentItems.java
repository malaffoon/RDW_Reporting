package org.opentestsystem.rdw.reporting.exam;

import com.google.common.base.Splitter;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

import static org.opentestsystem.rdw.reporting.common.jdbc.QueryUtils.getNullable;

/**
 *  Holds utility methods for mapping SQL query results to {@link AssessmentItem}s.
 */
public class AssessmentItems {

    private static final Splitter STANDARD_SPLITTER = Splitter.on('|');

    public static AssessmentItem map(final ResultSet row) throws SQLException {
        return AssessmentItem.builder()
                .id(row.getLong("id"))
                .position(row.getInt("position"))
                .bankItemKey(row.getString("natural_id"))
                .difficultyCode(row.getString("difficulty_code"))
                .maximumPoints(row.getInt("max_points"))
                .claim(row.getString("claim_code"))
                .target(row.getString("target_code"))
                .depthOfKnowledge(row.getString("dok_id")) // TODO: Should use code when it's available
                .mathPractice(getNullable(row, row.getInt("math_practice")))
                .commonCoreStandardIds(parseStandardIds(row.getString("common_core_standard_ids")))
                .build();
    }

    private static List<String> parseStandardIds(final String standardString) {
        return standardString == null ? null : STANDARD_SPLITTER.splitToList(standardString);
    }
}
