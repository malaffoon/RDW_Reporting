<!-- modal flyweight for student reports -->
<student-report-download #menuReportDownloader
                         [lockAssessmentType]="true"
                         [lockSubject]="true"
                         [lockSchoolYear]="true"></student-report-download>

<!-- Individual Assessment Result Container -->
<div class="assessment-result well">
  <div class="mb-md">
    <!-- Top Right Buttons -->
    <div class="row">
      <div class="col-xs-10 col-sm-11">
        <div class="row">
          <div class="col-md-8 mb-sm">
            <!-- Assessment Title -->
            <span class="tag tag-lg {{colorService.getColor(getGradeIdx(assessmentExam.assessment.grade))}}">
                  <span class="label">{{assessmentExam.assessment.grade | gradeDisplay}}</span>
                  {{assessmentExam.assessment.label}}
              </span>
          </div>
          <div class="col-md-4">
            <button
              class="btn btn-success btn-xs float-none-xs pull-right"
              angulartics2On="click"
              angularticsEvent="InstructionalResource"
              angularticsCategory="AssessmentResults"
              [angularticsProperties]="{label: assessmentExam.assessment.label}"
              [disabled]="false"
              [popover]="buttonPopover"
              popoverTitle="{{ 'labels.groups.results.assessment.instruct-button' | translate:{ level:assessmentExam.assessment.label } }}"
              container="body"
              (click)="loadInstructionalResources(0)"
              [outsideClick]="true">
              <i class="fa fa-list-alt"></i> {{'labels.groups.results.assessment.instruct' | translate }}
            </button>
          </div>
        </div>
      </div>
      <div class="col-xs-2 col-sm-1">
        <button class="btn btn-default btn-sm icon-only pull-right" (click)="collapsed = !collapsed"
                angulartics2On="click" angularticsEvent="ToggleCollapseResults" angularticsCategory="AssessmentResults">
          <i class="fa font-bold" [ngClass]="{'fa-angle-down':collapsed, 'fa-angle-up':!collapsed}"></i> <span
          class="sr-only">{{'prompt.collapse' | translate}}</span>
        </button>
      </div>
    </div>

    <div class="row mb-lg">
      <!-- Sessions -->
      <div class="col-md-3">
        <div *ngIf="allowFilterBySessions">
          <p><strong>{{'labels.groups.results.assessment.sessions-title' | translate}}</strong></p>
          <div class="btn-group-vertical">
            <a *ngFor="let session of sessions" class="aqua reverse multi-line btn"
               [ngClass]="{'gray-mid':!session.filter}" (click)="toggleSession(session)"
               angulartics2On="click" angularticsEvent="ToggleSession" angularticsCategory="AssessmentResults">
                    <span class="text-left">
                        <strong>{{session.date | date }}</strong>
                        <small
                          class="ml-sm">{{session.id || 'labels.groups.results.session-unknown' | translate }}</small>
                    </span>
            </a>
          </div>
        </div>
      </div>

      <!-- Aggregate Scale Score -->
      <average-scale-score
        [assessmentExam]="assessmentExam"
        [statistics]="statistics"
        [showValuesAsPercent]="showValuesAsPercent">
      </average-scale-score>
    </div>

    <!-- Student Results -->
    <div *ngIf="!collapsed" @fadeAnimation>
      <div class="col-md-4 z-index-over-data-table pl-0 mb-sm">
        <div class="select-menu-group">
          <label class="sr-only">{{ 'labels.groups.results.assessment.select-view' | translate }}</label>
          <div class="btn-group" dropdown>
            <button dropdownToggle type="button" class="btn btn-default btn-borderless dropdown-toggle">
              {{ currentResultsView.label | translate }} <i class="fa fa-angle-down"></i>
            </button>
            <ul *dropdownMenu class="dropdown-menu" role="menu">
              <li role="menuitem">
                <a class="dropdown-item"
                   popover="{{'messages.no-results-by-item' | translate }}"
                   triggers="{{ !resultsByStudentView.disabled ? '': 'mouseenter:mouseleave'}}"
                   placement="right"
                   [ngClass]="{'selected': currentResultsView == resultsByStudentView }">
                  <button [disabled]="resultsByStudentView.disabled"
                          class="btn btn-default btn-borderless"
                          (click)="setCurrentView(resultsByStudentView)">
                    {{ resultsByStudentView.label | translate }}
                  </button>
                </a>
              </li>
              <li role="menuitem">
                <a class="dropdown-item"
                   popover="{{ (assessmentExam.assessment.isSummative ? 'messages.no-results-by-item-for-summative-exams' : 'messages.no-results-by-item') | translate }}"
                   triggers="{{ !resultsByItemView.disabled ? '': 'mouseenter:mouseleave'}}"
                   placement="right"
                   [ngClass]="{'selected': currentResultsView == resultsByItemView }">
                  <button [disabled]="resultsByItemView.disabled"
                          class="btn btn-default btn-borderless"
                          (click)="setCurrentView(resultsByItemView)">
                    {{ resultsByItemView.label | translate }}
                  </button>
                </a>
              </li>
              <li role="menuitem">
                <a class="dropdown-item"
                   popover="{{ (assessmentExam.assessment.isSummative ? 'messages.no-distractor-analysis-for-summative-exams' : 'messages.no-distractor-analysis') | translate }}"
                   triggers="{{ !distractorAnalysisView.disabled ? '': 'mouseenter:mouseleave'}}"
                   placement="right"
                   [ngClass]="{'selected': currentResultsView == distractorAnalysisView }">
                  <button [disabled]="distractorAnalysisView.disabled"
                          class="btn btn-default btn-borderless"
                          (click)="setCurrentView(distractorAnalysisView)">
                    {{ distractorAnalysisView.label | translate }}
                  </button>
                </a>
              </li>
            </ul>
          </div>
          <button *ngIf="currentResultsView.canExport"
                  class="btn btn-sm btn-default"
                  [disabled]="!currentExportResults || !currentExportResults.hasDataToExport()"
                  (click)="currentExportResults.exportToCsv()">
            <i class="fa fa-cloud-download"></i> {{ 'labels.export.title' | translate }}
          </button>
        </div>
      </div>
      <div *ngIf="showStudentResults">
        <results-by-student
          [exams]="exams"
          [assessment]="assessmentExam.assessment"
          [minimumItemDataYear]="minimumItemDataYear">
        </results-by-student>
      </div>
      <div *ngIf="showItemsByPointsEarned">
        <results-by-item #resultsByItem
                         [showValuesAsPercent]="showValuesAsPercent"
                         [assessmentProvider]="assessmentProvider"
                         [assessment]="assessmentExam.assessment"
                         [exams]="exams">
        </results-by-item>
      </div>
      <div *ngIf="showDistractorAnalysis">
        <distractor-analysis #distractorAnalysis
                             [showValuesAsPercent]="showValuesAsPercent"
                             [assessmentProvider]="assessmentProvider"
                             [assessment]="assessmentExam.assessment"
                             [exams]="exams">
        </distractor-analysis>
      </div>
    </div>
  </div>
</div>
<ng-template #buttonPopover>
  <instructional-resource-popover [resources]="instructionalResources"></instructional-resource-popover>
</ng-template>
