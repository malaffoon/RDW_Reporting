<p-table #dataTable
         [columns]="columns"
         [rows]="rowsPerPageOptions[0]"
         [value]="table.rows"
         [rowTrackBy]="rowTrackBy"
         [paginator]="true"
         [pageLinks]="3"
         [alwaysShowPaginator]="false"
         [rowsPerPageOptions]="rowsPerPageOptions"
         (onPage)="onPage($event)"
         (sortFunction)="sort($event)"
         [sortMode]="rowSortingEnabled && 'single'"
         [customSort]="true"
         [autoLayout]="true"
         styleClass="table table-striped table-hover overflow table-row-size-fixed">
  <ng-template pTemplate="header"
               let-columns>
    <tr>
      <th *ngFor="let column of columns"
          [hidden]="!column.visible"
          [pSortableColumn]="column.field"
          [pSortableColumnDisabled]="!column.sortable"
          [ngSwitch]="column.id">

        <div *ngSwitchCase="'avgScaleScore'" class="text-center">
          <div>{{'aggregate-report-table.columns.avg-scale-score' | translate}}</div>
          <div>{{'aggregate-report-table.columns.avg-scale-score-suffix' | translate}}</div>
        </div>

        <div *ngSwitchCase="'performanceLevel'"
             class="text-center">
          <div class="label"
               [ngClass]="column.headerColor">
            {{ column.headerKey | translate }}
          </div>
          <div>{{ 'aggregate-report-table.columns.performance-level-suffix' | translate }}</div>
        </div>

        <span *ngSwitchDefault>
          {{('aggregate-report-table.columns.' + toDash(column.id)) | translate}}
        </span>

        <p-sortIcon *ngIf="rowSortingEnabled && column.sortable"
                    [field]="column.field"></p-sortIcon>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body"
               let-rowData
               let-i="rowIndex"
               let-columns="columns">
    <tr>
      <td *ngFor="let column of columns; let columnIdx = index;"
          [hidden]="!column.visible">
        <div [ngSwitch]="column.id"
             class="full-cell"
             [ngClass]="{
              'pt-0': column.id === 'achievementComparison',
              'hidden': treeColumns[i] > columnIdx,
              'border-top': treeColumns[i] <= columnIdx && treeColumns[i] < identityColumns.length - 1
             }">

          <div *ngSwitchCase="'organization'">
            <span class="label mr-xs"
                  [ngClass]="getOrganizationTypeColor(rowData.organization.type)">
              {{('common.organization.type.' + rowData.organization.type) | translate}}
            </span>
            {{rowData.organization.name}}
          </div>

          <div *ngSwitchCase="'assessmentLabel'">
            {{rowData.assessmentLabel}}
          </div>

          <div *ngSwitchCase="'assessmentGrade'"
               class="text-right">
            {{'common.assessment-grade.' + rowData.assessmentGradeCode | translate}}
          </div>

          <div *ngSwitchCase="'schoolYear'"
               class="text-right">
            {{rowData.schoolYear | schoolYear}}
          </div>

          <div *ngSwitchCase="'dimension'"
               class="label-max-width"
               title="{{rowData.dimension.name}}">
            {{rowData.dimension.name}}
          </div>

          <div *ngSwitchCase="'studentsTested'"
               class="text-right">
            {{rowData.studentsTested}}
          </div>

          <div *ngSwitchCase="'achievementComparison'">
            <performance-level-distribution-chart
              [percentages]="rowData.performanceLevelByDisplayTypes.Separate.Percent"
              [cutPoint]="table.assessmentDefinition.performanceLevelGroupingCutPoint"
              [assessmentTypeCode]="table.assessmentDefinition.typeCode"
              [displayType]="performanceLevelDisplayType"
              [center]="table.assessmentDefinition.performanceLevelGroupingCutPoint != null"></performance-level-distribution-chart>
          </div>

          <div *ngSwitchCase="'avgScaleScore'"
               class="text-center">
            <span *ngIf="!rowData.studentsTested">-</span>
            <span *ngIf="rowData.studentsTested">
              <scale-score [score]="rowData.avgScaleScore"
                           [standardError]="rowData.avgStdErr"></scale-score>
            </span>
          </div>

          <div *ngSwitchCase="'performanceLevel'"
               class="text-center">
            <span *ngIf="!rowData.studentsTested">-</span>
            <span *ngIf="rowData.studentsTested">
              {{
                ('common.value-display-type-format.' + valueDisplayType) | translate:{
                    value: readField(rowData, column.field)
                }
              }}
            </span>
          </div>

        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage" let-columns>
    <tr>
      <td [attr.colspan]="columns.length">
        {{'aggregate-report-table.empty-message' | translate}}
      </td>
    </tr>
  </ng-template>
</p-table>
