<h2 class="h3 blue-dark">{{report.label}}</h2>

<div class="row mb-sm">
  <div class="col-md-12">
    <button class="btn btn-default btn-sm" (click)="onUpdateRequestButtonClick()">
      <i class="fa fa-chevron-left mr-xs"></i>{{'aggregate-report.form-link' | translate}}
    </button>
  </div>
</div>
<div class="row">
  <div class="col-md-12">

    <ng-container *ngIf="reportProcessing">
      <spinner text="{{'aggregate-report.processing' | translate}}"></spinner>
    </ng-container>

    <ng-container *ngIf="reportNotLoadable">
      <div class="well">
        <p>{{'aggregate-report.error.unloadable' | translate}}</p>
        <button class="btn btn-primary" [routerLink]="['/reports']">{{'aggregate-report.reports-link' | translate}}</button>
      </div>
    </ng-container>

    <ng-container *ngIf="reportSizeNotSupported">
      <div class="well">
        <p>{{'aggregate-report.error.unsupported-size' | translate}}</p>
        <div>
          <button class="btn btn-danger btn-sm" (click)="onDisplayReportButtonClick()">{{'aggregate-report.display-report' | translate}}</button>
          <button class="btn btn-default btn-sm" (click)="onDownloadDataButtonClick()">{{'aggregate-report.download-data' | translate}}</button>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="reportView">
      <div *ngFor="let table of reportTables" class="well wide-content-container">
        <div class="row">
          <div class="col-md-12">
            <div>
              <h3 class="h3 label-group green pull-left">
                <span class="label">{{'common.assessment-type.' + query.assessmentTypeCode + '.short-name' | translate}}</span><span class="label">{{'common.subject.' + table.subjectCode + '.short-name' | translate}}</span>
              </h3>
              <button class="btn btn-sm btn-default ml-sm"
                      (click)="reportTable.exportTable(getExportName(table))"><i class="fa fa-cloud-download"></i> {{'common.export' | translate}}</button>
            </div>
            <div class="clearfix"></div>
            <div>
              <span class="pull-left flex-child">
                <label class="mr-xs">
                  <info-button title="{{'aggregate-report.column-order' | translate}}"
                               content="{{'aggregate-report.column-order-info' | translate}}">
                  </info-button>
                </label>
                <order-selector [items]="table.columnOrderingItems"
                                (itemsChange)="onColumnOrderChange(table, $event)"></order-selector>
              </span>
              <span class="pull-right flex-child ml-xs">
                <label class="mr-xs">{{'common.value-display-type-input-label' | translate}}</label>
                <sb-radio-button-group [options]="displayOptions.valueDisplayTypes"
                           [(ngModel)]="table.valueDisplayType"
                           buttonGroupStyles="btn-group-xs"
                           buttonStyles="btn-default"
                           analyticsCategory="AggregateReportControl"
                           analyticsEvent="Change"></sb-radio-button-group>
              </span>
              <span class="pull-right flex-child ml-xs">
                <label class="mr-xs">{{'common.performance-level-display-type-input-label' | translate}}</label>
                <sb-radio-button-group [options]="displayOptions.performanceLevelDisplayTypes"
                                       [(ngModel)]="table.performanceLevelDisplayType"
                                       buttonGroupStyles="btn-group-xs"
                                       buttonStyles="btn-default"
                                       analyticsCategory="AggregateReportControl"
                                       analyticsEvent="Change"></sb-radio-button-group>
              </span>
            </div>
          </div>
        </div>

        <div class="row mt-xs">
          <div class="col-md-12">
            <aggregate-report-table #reportTable
                                    [table]="table.table"
                                    [valueDisplayType]="table.valueDisplayType"
                                    [performanceLevelDisplayType]="table.performanceLevelDisplayType"
                                    [columnOrdering]="table.columnOrdering"></aggregate-report-table>
          </div>
        </div>
      </div>
    </ng-container>

  </div>
</div>

<spinner-modal #spinnerModal></spinner-modal>
