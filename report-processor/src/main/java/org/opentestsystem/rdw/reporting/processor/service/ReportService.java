package org.opentestsystem.rdw.reporting.processor.service;

import org.opentestsystem.rdw.reporting.processor.model.Report;

import java.util.Collection;
import java.util.List;
import java.util.Optional;

/**
 * Implementations of this interface are responsible for creating and retrieving Reports.
 */
public interface ReportService {

    /**
     * Insert a new Report record.
     *
     * @param report A report
     * @return The inserted Report with an initialized {@link Report#getId()}
     */
    Report create(Report report);

    /**
     * Find all Reports for a given user, optionally filtered by Report id.
     *
     * @param user      The user
     * @param reportIds Optional report id filter, empty returns all reports for the user
     * @return  The requested reports
     */
    List<Report> findAllByUserAndId(String user, Collection<Long> reportIds);

    /**
     * Find all Reports created a number of days ago
     *
     * @param numberOfDays The number of days
     * @return  The requested reports
     */
    List<Report> findAllOlderThanNumberOfDays(int numberOfDays);

    /**
     * Retrieve a report by id.
     *
     * @param reportId  The report id
     * @return The report, if it exists
     */
    Optional<Report> findOneById(long reportId);

    /**
     * Save an updated Report.
     * NOTE: The {@link Report#completeChunkCount} property is not updated by this method.
     * @see #completeChunk(Report)
     *
     * @param report A report
     * @return The saved report
     */
    Report update(final Report report);

    /**
     * Deletes a collection of reports specified by their ids
     * @param ids The ids of the reports to be removed
     */
    void delete(Collection<Long> ids);

    /**
     * Increment the chunk completion count for the given report
     * and return the updated Report instance.
     *
     * @param report A report
     * @return  The report with updated chunk completion count
     */
    Report completeChunk(final Report report);

}
