package org.opentestsystem.rdw.reporting.repository.impl;

import org.opentestsystem.rdw.reporting.repository.ArtifactRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.ResourceLoader;
import org.springframework.stereotype.Repository;

import java.io.IOException;
import java.io.InputStream;
import java.text.MessageFormat;

@Repository
public class ArtifactRepositoryImpl implements ArtifactRepository {
    private ArtifactProperties properties;
    private ResourceLoader resourceLoader;

    @Autowired
    public ArtifactRepositoryImpl(final ResourceLoader resourceLoader, final ArtifactProperties artifactProperties) {
        this.properties = artifactProperties;
        this.resourceLoader = resourceLoader;
    }

    @Override
    public InputStream getItemXml(final String id) throws IOException {
        return getArtifactFromItemDirectory(id, MessageFormat.format(properties.getExamItem().getFileName(), id));
    }

    @Override
    public InputStream getArtifactFromItemDirectory(final String id, final String artifactName) throws IOException {
        return getArtifact(MessageFormat.format(properties.getExamItem().getDirectory(), id) + artifactName);
    }

    private InputStream getArtifact(final String fullyQualifiedPath) throws IOException {
        return this.resourceLoader.getResource(properties.getRoot() + fullyQualifiedPath).getInputStream();
    }
}
