package org.opentestsystem.rdw.reporting.common.jdbc;

import org.opentestsystem.rdw.reporting.common.model.Assessment;
import org.opentestsystem.rdw.reporting.common.model.MeasuredAssessment;
import org.opentestsystem.rdw.reporting.common.model.Measures;

import java.sql.ResultSet;
import java.sql.SQLException;

/**
 * Holds utility methods for mapping SQL query results to {@link Assessment}
 */
public final class MeasuredAssessments {

    private MeasuredAssessments() {
    }

    public static <A extends MeasuredAssessment.Builder> A map(final ResultSet row, final A builder) throws SQLException {
        return map(row, builder, "");
    }

    public static <A extends MeasuredAssessment.Builder> A map(final ResultSet row, final A builder, final String prefix) throws SQLException {
        builder.assessment(Assessments.map(row, Assessment.builder(), "asmt_").build());
        builder.measures(Measures.builder()
                .level1Count(row.getInt(prefix + "level1"))
                .level2Count(row.getInt(prefix + "level2"))
                .level3Count(row.getInt(prefix + "level3"))
                .avgScaleScore(row.getInt(prefix + "score"))
                .avgStdErr(row.getInt(prefix + "std_err")).build());
        builder.completedAt(row.getTimestamp(prefix + "completed_at").toInstant());
        builder.studentsTested(row.getInt(prefix + "tested"));
        return builder;
    }
}
