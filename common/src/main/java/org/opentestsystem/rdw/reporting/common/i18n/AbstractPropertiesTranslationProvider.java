package org.opentestsystem.rdw.reporting.common.i18n;

import com.fasterxml.jackson.databind.node.ObjectNode;
import com.fasterxml.jackson.dataformat.javaprop.JavaPropsMapper;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.util.Locale;
import java.util.Properties;

/**
 * Implementations of this class are responsible for providing translation messages as
 * Properties instances.
 */
public abstract class AbstractPropertiesTranslationProvider implements TranslationProvider {
    private final Logger logger = LoggerFactory.getLogger(AbstractPropertiesTranslationProvider.class);

    /**
     * Retrieve the messages as string properties from the message source.
     *
     * @param locale    The locale
     * @return  The locale messages as string properties
     */
    protected abstract Properties getMessageProperties(final Locale locale);

    @Override
    public ObjectNode getMessages(final Locale locale) {
        final Properties properties = getMessageProperties(locale);
        final JavaPropsMapper propsMapper = new JavaPropsMapper();

        try {
            final String output = propsMapper.writeValueAsString(properties);
            return (ObjectNode) propsMapper.readTree(output);
        } catch (final IOException e) {
            logger.warn("Unable to parse message properties", e);
            return propsMapper.createObjectNode();
        }
    }
}
